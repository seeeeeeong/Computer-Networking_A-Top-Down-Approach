# 1.5 프로토콜 계층과 서비스 모델

---

## 1.5.1 계층구조

- **계층구조란?**  
  복잡한 시스템을 잘 정의된 여러 층(계층)으로 나누어, 각 계층별로 역할을 분리하고 단순화하는 설계 방식이다.  
  이를 통해 시스템의 각 부분을 독립적으로 논의, 구현, 변경할 수 있다.  
  즉, 한 계층의 내부 구현이 바뀌어도 다른 계층에 영향이 없다.

- **계층의 특징**  
  1. 각 계층은 자신이 어떤 일을 할지 정의한다.  
  2. 바로 아래 계층의 서비스를 이용해 자신이 제공하는 서비스를 구현한다.

---

## 프로토콜 계층화

- 네트워크 프로토콜은 계층별로 나누어 설계한다.  
- 각각의 프로토콜은 특정 계층에 속하며, 소프트웨어 또는 하드웨어로 구현될 수 있다.  
- 여러 계층의 프로토콜을 모아 **프로토콜 스택(protocol stack)** 이라고 한다.  
- 각 계층은 자신이 제공하는 서비스 모델(service model)을 가진다.

---

## 인터넷 프로토콜 스택

- 총 5계층으로 구성되어 있다:  
  **물리(Physical) → 링크(Link) → 네트워크(Network) → 트랜스포트(Transport) → 애플리케이션(Application)**

| 계층 이름       | 역할 및 설명                                                                                                         |
|-------------|------------------------------------------------------------------------------------------------------------------|
| **애플리케이션 계층** | - 네트워크 애플리케이션과 프로토콜이 위치<br>- 대표적 프로토콜: HTTP(웹), SMTP(메일), FTP(파일 전송), DNS(도메인 이름 해석)<br>- 애플리케이션 간 메시지 교환 담당 |
| **트랜스포트 계층**   | - 애플리케이션 메시지를 클라이언트와 서버 간에 전송하는 서비스 제공<br>- 주요 프로토콜: TCP(연결 지향, 신뢰성, 흐름·혼잡 제어 포함), UDP(비연결형, 최소 기능)      |
| **네트워크 계층 (IP)** | - 한 호스트에서 다른 호스트로 데이터그램(IP 패킷)을 라우팅<br>- IP 프로토콜 수행, 출발지와 목적지 주소 관리<br>- 라우팅 프로토콜 포함(경로 결정)                      |
| **링크 계층**       | - 한 네트워크 요소에서 이웃 네트워크 요소로 프레임 전송<br>- 특정 링크 프로토콜에 따라 동작<br>- 여러 종류의 링크 프로토콜 혼재 가능                         |
| **물리 계층**       | - 프레임 내의 각 비트를 실제 전송 매체를 통해 전달<br>- 케이블, 무선 등 물리적 매체에 따라 규격 다름                                                  |

---

## 1.5.2 캡슐화 (Encapsulation)

- **데이터의 흐름**  
  송신 측의 애플리케이션에서 만들어진 메시지가 각 계층을 거치면서 헤더 정보가 추가되어 물리 계층까지 내려가고,  
  수신 측에서는 이 과정을 거꾸로 하여 원본 메시지를 복원한다.

- **캡슐화 과정**  
  1. 애플리케이션 메시지(M)가 트랜스포트 계층으로 전달된다.  
  2. 트랜스포트 계층은 메시지에 헤더(Ht)를 붙여 **세그먼트(segment)** 를 만든다.  
     - 헤더에는 수신 측 트랜스포트 계층 정보, 오류 검출 비트 등이 포함됨  
  3. 세그먼트는 네트워크 계층으로 넘어가고, 네트워크 계층은 헤더(Hn)를 붙여 **데이터그램(datagram)** 을 만든다.  
  4. 데이터그램은 링크 계층으로 넘어가며, 링크 계층은 다시 헤더를 붙여 **프레임(frame)** 으로 만든다.  
  5. 물리 계층에서 비트 단위로 전송된다.

- **중간 네트워크 장비**  
  - 라우터는 보통 1~3계층(물리, 링크, 네트워크)까지만 구현  
  - 링크 계층 스위치는 1~2계층까지만 구현  
  - 호스트(종단 시스템)는 1~5계층 모두 구현  
  - 따라서 복잡한 처리는 네트워크 가장자리(호스트)에서 수행됨

- **추가 사항**  
  - 큰 메시지는 여러 개의 세그먼트로 나누어 전송 가능  
  - 수신 측에서 세그먼트들을 다시 조립해야 함

---

## 요약

- **계층구조**는 복잡한 네트워크를 단순화하고 독립적 관리가 가능하도록 설계  
- **프로토콜 스택**은 여러 계층 프로토콜의 집합이며, 각 계층은 자신의 역할과 서비스 모델을 가짐  
- **캡슐화**는 데이터를 전송할 때 각 계층이 헤더를 붙여 데이터를 감싸는 과정  
- 네트워크 장비별로 구현하는 계층이 다르며, 복잡한 기능은 종단 시스템에서 처리함


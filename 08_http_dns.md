# 2.2 웹과 HTTP

웹은 온디맨드(on-demand) 방식으로 사용자가 원할 때 원하는 것을 수신한다.  
개인은 또한, 웹 상에서 많은 정보를 얻고 상호작용할 수 있다.

---

## 2.2.1 HTTP 개요

- 웹 애플리케이션 계층 프로토콜은 웹의 중심이다.  
- RFC 1945, RFC 7230, RFC 7540에 정의되어 있다.  
- HTTP는 메시지의 구조 및 클라이언트와 서버가 메시지를 어떻게 교환하는지에 대해 정의하고 있다.

### 웹 페이지 (web page)

- 웹 페이지는 여러 객체(object)로 구성된다.  
- 객체는 단일 URL로 지정할 수 있는 하나의 파일(HTML, JPEG 이미지, 자바스크립트 등)이다.  
- 대부분의 웹 페이지는 기본 HTML 파일과 여러 참조 객체로 구성된다.  
- 예: HTML 텍스트와 5개의 JPEG 이미지로 구성된 웹 페이지는 총 6개의 객체를 갖는다.  
- 기본 HTML 파일은 페이지 내부의 다른 객체를 그 객체의 URL로 참조한다.

#### URL 예시

http://www.school.edu/picture.gif


- 호스트 이름: www.school.edu  
- 경로 이름: picture.gif

### 웹 브라우저와 클라이언트

- 웹 브라우저(Web browser)는 HTTP의 클라이언트 측 구현체이므로 브라우저와 클라이언트를 혼용하여 사용한다.  
- 브라우저는 웹 페이지를 보여주고 인터넷 탐색 기능을 제공한다.

### 웹 서버

- 웹 서버(Web server)는 URL로 지정 가능한 웹 객체를 갖고 있다.  
- 사용자가 웹 페이지를 요청하면:  
  1. 브라우저는 객체에 대한 HTTP 요청 메시지를 서버에 보낸다.  
  2. 서버는 HTTP 응답 메시지로 요청 객체를 전송한다.

### HTTP와 TCP

- HTTP는 TCP를 전송 프로토콜로 사용한다.  
- HTTP 클라이언트는 서버에 TCP 연결을 생성 후, 요청 메시지를 보낸다.  
- TCP는 신뢰적인 데이터 전송을 보장하므로 HTTP는 데이터 손실에 신경 쓰지 않는다.

### 비상태(stateless) 프로토콜

- HTTP 서버는 클라이언트 상태를 유지하지 않는다.  
- 동일한 클라이언트가 같은 객체를 두 번 요청해도 서버는 이전 요청 사실을 기억하지 않고 항상 객체를 보낸다.

---

## 2.2.2 비지속 연결과 지속 연결

### 비지속(non-persistent) 연결

- 각 요청/응답 쌍이 별도의 TCP 연결을 통해 전달된다.  
- 예를 들어, HTML 파일과 10개의 이미지로 구성된 웹 페이지 요청 시 TCP 연결 11개 생성된다.

#### 비지속 연결 과정

1. 클라이언트는 TCP 연결을 서버에 설정한다.  
2. HTTP 요청 메시지를 보낸다.  
3. 서버는 객체를 읽어 HTTP 응답 메시지로 보낸다.  
4. 서버는 TCP 연결을 끊으라고 지시한다.  
5. 클라이언트가 응답을 다 받으면 TCP 연결 종료.  
6. HTML 파일 내 다른 객체들(예: 이미지)에 대해 위 과정을 반복.

### 비지속 연결의 단점

- 각 요청마다 TCP 연결 설정 및 종료가 발생해 오버헤드가 크다.  
- 각 연결마다 2 RTT(round-trip-time)가 필요해 지연이 크다.  
- 서버에 많은 부하를 준다.

### 지속(persistent) 연결

- HTTP/1.1부터 지원  
- 하나의 TCP 연결을 유지하며 여러 요청/응답을 처리한다.  
- 파이프라이닝(pipelining)을 통해 여러 요청을 연속으로 보낼 수 있다.  
- 일정 시간 사용하지 않으면 연결 종료.

---

## HTTP 메시지 포맷

### HTTP 요청 메시지 예시

GET /somedir/page.html HTTP/1.1 <br>
Host: www.someschool.edu <br>
Connection: close <br>
User-agent: Mozilla/5.0 <br>
Accept-language: fr <br>


- ASCII 텍스트 기반이며, 줄 끝은 CR+LF로 구분된다.  
- 첫 줄은 요청 라인(방식, URL, HTTP 버전)이다.  
- 다음 줄은 헤더 라인(Host, Connection, User-agent 등).

#### 주요 요청 메서드

- GET: 객체 요청  
- POST: 서버에 데이터 전송 (예: 폼 데이터)  
- HEAD: GET과 같으나 메시지 본문 미전송 (디버깅용)  
- PUT: 객체 업로드  
- DELETE: 객체 삭제

### HTTP 응답 메시지 예시

HTTP/1.1 200 OK <br>
Connection: close <br>
Date: Tue, 18 Aug 2015 15:44:04 GMT <br>
Server: Apache/2.2.3 (CentOS) <br>
Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT <br>
Content-Length: 6821 <br>
Content-Type: text/html <br> <br>

(data data data ...) <br>


- 상태 라인: HTTP 버전, 상태 코드, 상태 메시지 포함  
- 상태 코드 예:  
  - 200 OK: 성공  
  - 301 Moved Permanently: 영구 이동, Location 헤더에 새 URL 포함  
  - 400 Bad Request: 잘못된 요청  
  - 404 Not Found: 요청 문서 없음  
  - 505 HTTP Version Not Supported: 버전 미지원

- 헤더 라인: Connection, Date, Server, Last-Modified, Content-Length, Content-Type 등

---

## 2.2.4 쿠키(cookie)를 이용한 상태 유지

- HTTP는 비상태 프로토콜이므로 상태 유지가 필요할 때 쿠키를 사용한다.

### 쿠키 동작 과정

1. 클라이언트가 HTTP 요청을 서버로 보냄.  
2. 서버는 유일 식별번호 생성 후, 백엔드 DB에 엔트리 생성.  
3. 서버는 응답 메시지에 `Set-Cookie` 헤더로 식별번호 포함.  
4. 클라이언트 브라우저는 쿠키를 저장.  
5. 이후 동일 서버 요청 시 쿠키를 `Cookie` 헤더에 포함하여 보냄.  
6. 서버는 쿠키로 사용자를 식별.

---

## 2.2.5 웹 캐싱 (Web Caching)

- 웹 캐시는 기점(origin) 서버 대신 HTTP 요청을 처리하는 객체이다.  
- 자체 저장소에 최근 객체를 저장하여 응답 시간을 줄이고 네트워크 부하 감소.

### 프록시 서버 동작 과정

1. 클라이언트는 웹 캐시와 TCP 연결을 맺고 요청을 보냄.  
2. 캐시는 요청한 객체가 있으면 클라이언트에 전송.  
3. 없으면 기점 서버에 요청하여 객체 수신 후 저장하고 클라이언트에 전달.

### 웹 캐시의 효과

- 응답 시간 단축  
- 인터넷 링크 트래픽 감소  
- 전체 인터넷 트래픽 감소 및 성능 향상

### 조건부(Conditional) GET

- 캐시된 객체가 최신인지 확인하기 위한 GET 요청.  
- 요청에 `If-Modified-Since` 헤더 포함.  
- 서버는 객체가 수정되지 않았으면 `304 Not Modified` 응답, 데이터 전송 생략.

---

## 2.2.6 HTTP/2

- 2020년 기준 주요 사이트의 40%가 HTTP/2 지원.  
- 목표: 단일 TCP 연결에서 멀티플렉싱으로 요청/응답 지연 최소화.  
- 요청 우선순위 지정, 서버 푸시, 헤더 압축 제공.

### 기존 HTTP/1.1의 문제점

- 다중 TCP 연결로 Head-of-Line (HOL) 블로킹 완화.  
- TCP 혼잡 제어로 각 연결이 병목 대역폭을 나누어 가짐.

### HTTP/2 프레이밍 (Framing)

- HTTP 메시지를 작은 프레임 단위로 분할, 인터리빙(interleaving), 재조립함.  
- 예: 비디오 클립 + 여러 작은 객체를 프레임 단위로 섞어 보냄.  
- 프레임은 바이너리 인코딩되어 효율적이고 에러에 강함.

### 메시지 우선순위화

- 요청에 1~256 가중치를 부여해 우선순위 지정 가능.  
- 서버는 높은 우선순위 프레임부터 전송.

### 서버 푸시

- 서버가 클라이언트 요청 없이도 필요한 추가 객체를 미리 푸시 전송 가능.  
- HTML 분석 후 필요한 객체를 미리 보내어 지연 감소.

---

## HTTP/3

- QUIC 프로토콜 위에서 동작하는 차세대 HTTP 프로토콜.  
- 아직 완전 표준화 전임.

---

# 참고

- RTT(round-trip-time): 클라이언트에서 서버로 패킷 왕복 시간  
- CR: carriage return (복귀)  
- LF: line feed (줄바꿈)  
- HOL (Head-of-Line) 블로킹: 앞쪽 데이터 지연으로 전체 지연 발생 현상

